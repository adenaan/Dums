<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domino Game</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #222; color: white; margin: 0; padding: 0; }
    #game { padding: 20px; text-align: center; }
    #hand, #board { display: flex; flex-wrap: wrap; justify-content: center; margin: 10px 0; }
    .tile {
      background: #fff;
      color: #000;
      border: 2px solid #000;
      border-radius: 5px;
      margin: 5px;
      padding: 10px;
      font-weight: bold;
      width: 50px;
      cursor: pointer;
    }
    .tile.selected {
      border-color: red;
    }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
    }
    #status { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <div id="game">
    <h1>Domino Game</h1>
    <input type="text" id="roomCode" placeholder="Room Code">
    <button onclick="joinRoom()">Join Room</button>
    <div id="status">Not connected</div>
    <div id="board"></div>
    <h2>Your Hand</h2>
    <div id="hand"></div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://dominoesgame.glitch.me");
    const handEl = document.getElementById("hand");
    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");

    let selectedTile = null;
    let currentTurn = null;
    let myId = null;
    let currentRoom = null;

    socket.on("connect", () => {
      myId = socket.id;
      statusEl.textContent = "Connected!";
    });

    function joinRoom() {
      const roomCode = document.getElementById("roomCode").value.trim();
      if (roomCode) {
        socket.emit("join-room", roomCode);
        currentRoom = roomCode;
        statusEl.textContent = "Joining room...";
      }
    }

    socket.on("player-joined", (players) => {
      statusEl.textContent = `Players in room: ${players.length}`;
    });

    socket.on("tiles", (tiles) => {
      renderHand(tiles);
    });

    socket.on("game-start", ({ board, players, currentTurn: turn }) => {
      currentTurn = turn;
      renderBoard(board);
      updateTurnDisplay();
    });

    socket.on("board-updated", ({ board, tilesLeft, currentTurn: turn }) => {
      currentTurn = turn;
      renderBoard(board);
      if (tilesLeft[socket.id]) renderHand(tilesLeft[socket.id]);
      updateTurnDisplay();
    });

    function renderHand(tiles) {
      handEl.innerHTML = "";
      tiles.forEach((tile, index) => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]}|${tile[1]}`;
        el.addEventListener("click", () => {
          selectedTile = tile;
          document.querySelectorAll(".tile").forEach(t => t.classList.remove("selected"));
          el.classList.add("selected");
        });
        handEl.appendChild(el);
      });
    }

    function renderBoard(tiles) {
      boardEl.innerHTML = "";
      tiles.forEach(tile => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]}|${tile[1]}`;
        boardEl.appendChild(el);
      });
    }

    function updateTurnDisplay() {
      if (currentTurn === socket.id) {
        statusEl.textContent = "Your turn - tap a tile, then tap the board to place it.";
      } else {
        statusEl.textContent = "Waiting for opponent...";
      }
    }

    boardEl.addEventListener("click", () => {
      if (selectedTile && currentTurn === socket.id && currentRoom) {
        socket.emit("play-tile", { roomCode: currentRoom, tile: selectedTile });
        selectedTile = null;
      }
    });
  </script>
</body>
</html>
