<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Domino Game</title>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; padding: 20px; }
    h1, h2 { text-align: center; }
    #hand, #board { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
    .tile {
      background: #eee; color: #000; border: 2px solid #000; border-radius: 8px;
      padding: 10px; margin: 5px; font-size: 18px; cursor: grab; width: 60px; text-align: center;
    }
    #status { text-align: center; margin-top: 10px; font-weight: bold; }
    input, button { padding: 10px; font-size: 16px; margin: 5px; }
    .selected { border: 2px solid red; }
  </style>
</head>
<body>
  <h1>Domino Game</h1>
  <div style="text-align:center">
    <input type="text" id="roomCode" placeholder="Enter Room Code">
    <button onclick="joinRoom()">Join Room</button>
  </div>
  <div id="status">Not connected</div>
  <div id="board"></div>
  <h2>Your Hand</h2>
  <div id="hand"></div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://dominoesgame.glitch.me");
    const hand = document.getElementById("hand");
    const board = document.getElementById("board");
    const status = document.getElementById("status");

    let myId = null;
    let myTiles = [];
    let currentTurn = null;
    let roomCode = null;
    let boardTiles = [];

    socket.on("connect", () => {
      myId = socket.id;
      status.textContent = "Connected to server.";
    });

    function joinRoom() {
      roomCode = document.getElementById("roomCode").value.trim();
      if (roomCode) {
        socket.emit("join-room", roomCode);
        status.textContent = "Joining room...";
      }
    }

    socket.on("player-joined", (players) => {
      status.textContent = `Players in room: ${players.length}`;
    });

    socket.on("tiles", (tiles) => {
      myTiles = tiles;
      renderHand();
    });

    socket.on("game-start", ({ board: boardState, players, currentTurn: turn }) => {
      currentTurn = turn;
      boardTiles = boardState;
      renderBoard();
      updateStatus();
    });

    socket.on("board-updated", ({ board: boardState, tilesLeft, currentTurn: turn }) => {
      currentTurn = turn;
      boardTiles = boardState;
      if (tilesLeft[myId]) {
        myTiles = tilesLeft[myId];
        renderHand();
      }
      renderBoard();
      updateStatus();
    });

    function renderHand() {
      hand.innerHTML = "";
      myTiles.forEach(tile => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]}|${tile[1]}`;
        el.onclick = () => playTile(tile);
        hand.appendChild(el);
      });
    }

    function renderBoard() {
      board.innerHTML = "";
      boardTiles.forEach(tile => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]}|${tile[1]}`;
        board.appendChild(el);
      });
    }

    function playTile(tile) {
      if (currentTurn !== myId) {
        alert("Not your turn!");
        return;
      }

      // Validate move
      if (boardTiles.length === 0) {
        socket.emit("play-tile", { roomCode, tile });
        return;
      }

      const [first, last] = [boardTiles[0][0], boardTiles[boardTiles.length - 1][1]];
      if (tile[0] === first || tile[1] === first || tile[0] === last || tile[1] === last) {
        socket.emit("play-tile", { roomCode, tile });
      } else {
        alert("Invalid move. Tile does not match either end of the board.");
      }
    }

    function updateStatus() {
      status.textContent = (currentTurn === myId) ? "Your turn" : "Waiting for opponent...";
    }
  </script>
</body>
</html>
