<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domino Game</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; background: #f0f0f0; }
    #game { max-width: 600px; margin: 0 auto; padding: 1em; }
    #hand, #board { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
    .tile { background: white; border: 2px solid #333; border-radius: 8px; padding: 10px; width: 60px; height: 30px; display: flex; justify-content: space-around; align-items: center; cursor: pointer; }
    .selected { border-color: red; }
    input, button { padding: 8px; font-size: 1em; margin: 5px; }
    #status { margin-top: 15px; }
  </style>
</head>
<body>
  <div id="game">
    <h2>Domino Game</h2>
    <input type="text" id="roomCode" placeholder="Enter Room Code" />
    <button onclick="joinRoom()">Join Room</button>
    <div id="status">Not connected</div>
    <div id="board"></div>
    <h3>Your Hand</h3>
    <div id="hand"></div>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("https://dominoesgame.glitch.me");
    const handEl = document.getElementById("hand");
    const boardEl = document.getElementById("board");
    const statusEl = document.getElementById("status");

    let selectedTile = null;
    let currentTurn = null;
    let myId = null;
    let currentRoom = null;

    socket.on("connect", () => {
      myId = socket.id;
      statusEl.textContent = "Connected!";
    });

    function joinRoom() {
      const roomCode = document.getElementById("roomCode").value.trim();
      if (roomCode) {
        socket.emit("join-room", roomCode);
        currentRoom = roomCode;
        statusEl.textContent = "Joining room...";
      }
    }

    socket.on("player-joined", (players) => {
      statusEl.textContent = `Players in room: ${players.length}`;
    });

    socket.on("tiles", (tiles) => {
      renderHand(tiles);
    });

    socket.on("game-start", ({ board, players, currentTurn: turn }) => {
      currentTurn = turn;
      renderBoard(board);
      updateTurnDisplay();
    });

    socket.on("board-updated", ({ board, tilesLeft, currentTurn: turn }) => {
      currentTurn = turn;
      renderBoard(board);
      if (tilesLeft[socket.id]) renderHand(tilesLeft[socket.id]);
      updateTurnDisplay();
    });

    function renderHand(tiles) {
      handEl.innerHTML = "";
      tiles.forEach(tile => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]} | ${tile[1]}`;
        el.onclick = () => {
          if (selectedTile === tile) {
            selectedTile = null;
            el.classList.remove("selected");
          } else {
            selectedTile = tile;
            [...handEl.children].forEach(c => c.classList.remove("selected"));
            el.classList.add("selected");
          }
        };
        handEl.appendChild(el);
      });
    }

    function renderBoard(tiles) {
      boardEl.innerHTML = "";
      tiles.forEach(tile => {
        const el = document.createElement("div");
        el.className = "tile";
        el.textContent = `${tile[0]} | ${tile[1]}`;
        boardEl.appendChild(el);
      });
    }

    function updateTurnDisplay() {
      if (currentTurn === socket.id) {
        statusEl.textContent = "Your turn - tap a tile then tap the board to play";
      } else {
        statusEl.textContent = "Waiting for opponent...";
      }
    }

    boardEl.addEventListener("click", () => {
      if (selectedTile && currentTurn === socket.id) {
        socket.emit("play-tile", { roomCode: currentRoom, tile: selectedTile });
        selectedTile = null;
      }
    });
  </script>
</body>
</html>
