<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domino Game</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    #game {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    #board, #hand {
      display: flex;
      flex-wrap: wrap;
      margin: 10px;
    }
    .tile {
      width: 50px;
      height: 100px;
      background: white;
      border: 1px solid black;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      margin: 5px;
      font-size: 20px;
      touch-action: manipulation;
    }
    .highlight {
      border: 3px solid green;
    }
    .disabled {
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div id="game">
    <input id="roomCode" placeholder="Enter Room Code" />
    <button onclick="joinRoom()">Join Room</button>
    <div id="status"></div>
    <div id="board"></div>
    <div id="hand"></div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script>
    const socket = io("https://dominoesgame.glitch.me", {
      transports: ["websocket"]
    });

    let roomCode = "";
    let hand = [];
    let board = [];
    let currentTurn = "";
    let playerId = "";
    let players = [];
    let consecutivePasses = 0;

    socket.on("connect", () => {
      playerId = socket.id;
    });

    function joinRoom() {
      roomCode = document.getElementById("roomCode").value;
      socket.emit("join-room", roomCode);
    }

    socket.on("player-joined", (playerList) => {
      players = playerList;
      document.getElementById("status").textContent = `Players in room: ${players.length}`;
    });

    socket.on("tiles", (tiles) => {
      hand = tiles;
      renderHand();
    });

    socket.on("game-start", (data) => {
      board = data.board;
      currentTurn = data.currentTurn;
      players = data.players;
      consecutivePasses = 0;
      renderBoard();
      renderHand();
      updateStatus();
    });

    socket.on("board-updated", (data) => {
      board = data.board;
      currentTurn = data.currentTurn;
      consecutivePasses = data.consecutivePasses;
      renderBoard();
      renderHand();
      updateStatus();
      checkBlockedTurn();
    });

    function renderBoard() {
      const boardDiv = document.getElementById("board");
      boardDiv.innerHTML = "";
      board.forEach(tile => {
        const div = createTile(tile);
        boardDiv.appendChild(div);
      });
    }

    function renderHand() {
      const handDiv = document.getElementById("hand");
      handDiv.innerHTML = "";
      hand.forEach(tile => {
        const div = createTile(tile);
        div.onclick = () => playTile(tile);
        if (!isPlayable(tile)) div.classList.add("disabled");
        handDiv.appendChild(div);
      });
    }

    function updateStatus() {
      document.getElementById("status").textContent = currentTurn === playerId ? "Your turn" : "Waiting...";
    }

    function createTile([a, b]) {
      const div = document.createElement("div");
      div.className = "tile";
      div.innerHTML = `<div>${a}</div><div>${b}</div>`;
      return div;
    }

    function isPlayable([a, b]) {
      if (board.length === 0) return true;
      const [start, end] = [board[0][0], board[board.length - 1][1]];
      return [a, b].includes(start) || [a, b].includes(end);
    }

    function playTile(tile) {
      if (currentTurn !== playerId || !isPlayable(tile)) return;
      socket.emit("play-tile", { roomCode, tile });
    }

    function checkBlockedTurn() {
      if (currentTurn !== playerId) return;
      const playable = hand.some(isPlayable);
      if (!playable) {
        setTimeout(() => {
          socket.emit("pass-turn", roomCode);
        }, 500);
      }
    }
  </script>
</body>
</html>
